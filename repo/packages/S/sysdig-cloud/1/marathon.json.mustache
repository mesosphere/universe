{
    "id": "{{sysdigcloud.app_id}}",
    "cpus": {{sysdigcloud.cpus}},
    "constraints": [["hostname", "UNIQUE"]],
    "mem": {{sysdigcloud.mem}},
    "instances": {{sysdigcloud.instances}},
    "healthChecks": [
        {
            "protocol": "COMMAND",
            "command": { "value": "exit 0" },
            "gracePeriodSeconds": 120,
            "intervalSeconds": 60,
            "timeoutSeconds": 20,
            "maxConsecutiveFailures": 3
        }
    ],
    "env": {
        "ACCESS_KEY": "{{sysdigcloud.access_key}}",
        "COLLECTOR": "{{sysdigcloud.collector_endpoint}}",
        "COLLECTOR_PORT": "{{sysdigcloud.collector_port}}",
        "SECURE": "{{sysdigcloud.agent_secure}}",
        "CHECK_CERTIFICATE": "{{sysdigcloud.agent_check_cert}}",        
        "TAGS": "{{sysdigcloud.agent_tags}}",
        "ADDITIONAL_CONF": "{{sysdigcloud.add_conf}}"
    },
    "container": {
        "type": "DOCKER",
        "docker": {
            "image": "{{resource.assets.container.docker.agent}}",
            "network": "HOST",
            "privileged": true,
            "forcePullImage": true,
            "parameters": [
                {
                    "key": "name", "value": "sysdig-agent"
                },
                {
                    "key": "pid", "value": "host"
                },
                {  
                    "key": "shm-size","value": "350m"
                }
            ]
        },
        "volumes": [
            {
                "containerPath": "/host/var/run/docker.sock",
                "hostPath": "/var/run/docker.sock",
                "mode": "RW"
            },
            {
                "containerPath": "/host/dev",
                "hostPath": "/dev",
                "mode": "RW"
            },
            {
                "containerPath": "/host/proc",
                "hostPath": "/proc",
                "mode": "RO"
            },
            {
                "containerPath": "/host/boot",
                "hostPath": "/boot",
                "mode": "RO"
            },
            {
                "containerPath": "/host/lib/modules",
                "hostPath": "/lib/modules",
                "mode": "RO"
            },
            {
                "containerPath": "/host/usr",
                "hostPath": "/usr",
                "mode": "RO"
            }
        ]
    },
    "acceptedResourceRoles": ["slave_public", "*"]
}
