{
  "id": "{{marathon-lb.name}}",
  "instances": {{marathon-lb.instances}},
  "cpus": {{marathon-lb.cpus}},
  "mem": {{marathon-lb.mem}},
  "maintainer": "support@mesosphere.io",
  "container": {
    "type": "DOCKER",
    "docker": {
      "image": "{{resource.assets.container.docker.marathon-lb-docker}}",
      "network": "HOST",
      "privileged": true,
      "parameters": [
      {{#marathon-lb.parameters}}
        {
          "key": "{{key}}",
          "value": "{{value}}"
        },
      {{/marathon-lb.parameters}}
        {
          "key": "label",
          "value": "created_by=marathon"
        },
        {
          "key": "label",
          "value": "dcos_pkg_name=marathon-lb"
        }
      ]
    }
  },
  {{#marathon-lb.role}}
  "acceptedResourceRoles": [
    "{{marathon-lb.role}}"
  ],
  {{/marathon-lb.role}}
  "healthChecks": [
    {
      "path": "/_haproxy_health_check",
  {{#marathon-lb.bind-http-https}}
      "portIndex": 2,
  {{/marathon-lb.bind-http-https}}
  {{^marathon-lb.bind-http-https}}
      "portIndex": 0,
  {{/marathon-lb.bind-http-https}}
      "protocol": "HTTP",
      "gracePeriodSeconds": 60,
      "intervalSeconds": 5,
      "timeoutSeconds": 2,
      "maxConsecutiveFailures": 2,
      "ignoreHttp1xx": false
    }
  ],
  "upgradeStrategy": {
    "minimumHealthCapacity": {{marathon-lb.minimumHealthCapacity}},
    "maximumOverCapacity": {{marathon-lb.maximumOverCapacity}}
  },
  "args":[
    "sse",
    "-m", "{{marathon-lb.marathon-uri}}",
    "--health-check",
  {{^marathon-lb.bind-http-https}}
    "--dont-bind-http-https",
  {{/marathon-lb.bind-http-https}}
  {{#marathon-lb.haproxy-map}}
    "--haproxy-map",
  {{/marathon-lb.haproxy-map}}
  {{#marathon-lb.auto-assign-service-ports}}
    "--min-serv-port-ip-per-task", "10101",
    "--max-serv-port-ip-per-task", "10150",
  {{/marathon-lb.auto-assign-service-ports}}
  {{#marathon-lb.strict-mode}}
    "--strict-mode",
  {{/marathon-lb.strict-mode}}
    "--max-reload-retries", "{{marathon-lb.max-reload-retries}}",
    "--reload-interval", "{{marathon-lb.reload-interval}}",
    "--group", "{{marathon-lb.haproxy-group}}"
  ],
  "requirePorts":true,
  {{#marathon-lb.template-url}}
  "uris": [ "{{marathon-lb.template-url}}" ],
  {{/marathon-lb.template-url}}
  "env": {
    {{#marathon-lb.secret_name}}
    "DCOS_SERVICE_ACCOUNT_CREDENTIAL": { "secret": "serviceCredential" },
    {{/marathon-lb.secret_name}}
    {{#marathon-lb.haproxy_global_default_options}}
    "HAPROXY_GLOBAL_DEFAULT_OPTIONS": "{{marathon-lb.haproxy_global_default_options}}",
    {{/marathon-lb.haproxy_global_default_options}}
    "HAPROXY_SSL_CERT": "{{marathon-lb.ssl-cert}}",
    {{#marathon-lb.container-syslogd}}
    "HAPROXY_SYSLOGD": "{{marathon-lb.container-syslogd}}",
    {{/marathon-lb.container-syslogd}}
    "HAPROXY_SYSCTL_PARAMS": "{{marathon-lb.sysctl-params}}"
  },
  {{#marathon-lb.secret_name}}
  "secrets": {
    "serviceCredential": {
      "source": "{{marathon-lb.secret_name}}"
    }
  },
  {{/marathon-lb.secret_name}}
  "ports": [
  {{#marathon-lb.bind-http-https}}
    80,
    443,
  {{/marathon-lb.bind-http-https}}
    9090,
    9091,
    10000,
    10001,
    10002,
    10003,
    10004,
    10005,
    10006,
    10007,
    10008,
    10009,
    10010,
    10011,
    10012,
    10013,
    10014,
    10015,
    10016,
    10017,
    10018,
    10019,
    10020,
    10021,
    10022,
    10023,
    10024,
    10025,
    10026,
    10027,
    10028,
    10029,
    10030,
    10031,
    10032,
    10033,
    10034,
    10035,
    10036,
    10037,
    10038,
    10039,
    10040,
    10041,
    10042,
    10043,
    10044,
    10045,
    10046,
    10047,
    10048,
    10049,
    10050,
    10051,
    10052,
    10053,
    10054,
    10055,
    10056,
    10057,
    10058,
    10059,
    10060,
    10061,
    10062,
    10063,
    10064,
    10065,
    10066,
    10067,
    10068,
    10069,
    10070,
    10071,
    10072,
    10073,
    10074,
    10075,
    10076,
    10077,
    10078,
    10079,
    10080,
    10081,
    10082,
    10083,
    10084,
    10085,
    10086,
    10087,
    10088,
    10089,
    10090,
    10091,
    10092,
    10093,
    10094,
    10095,
    10096,
    10097,
    10098,
    10099,
    10100
  {{#marathon-lb.auto-assign-service-ports}}
    ,
    10101,
    10102,
    10103,
    10104,
    10105,
    10106,
    10107,
    10108,
    10109,
    10110,
    10111,
    10112,
    10113,
    10114,
    10115,
    10116,
    10117,
    10118,
    10119,
    10120,
    10121,
    10122,
    10123,
    10124,
    10125,
    10126,
    10127,
    10128,
    10129,
    10130,
    10131,
    10132,
    10133,
    10134,
    10135,
    10136,
    10137,
    10138,
    10139,
    10140,
    10141,
    10142,
    10143,
    10144,
    10145,
    10146,
    10147,
    10148,
    10149,
    10150
  {{/marathon-lb.auto-assign-service-ports}}
  ]
}
