{
  "id": "{{kafka.framework-name}}",
  "cpus": 1.0,
  "mem": 1230,
  "instances": 1,
  "cmd": "export PATH=$PATH:$MESOS_SANDBOX/jre/bin && java -Xmx1024m -jar kafka-scheduler*.jar",
  "labels": {
    "DCOS_PACKAGE_FRAMEWORK_NAME": "{{kafka.framework-name}}"
  },
  "env": {
    "LD_LIBRARY_PATH": "/opt/mesosphere/lib",
    "FRAMEWORK_NAME": "{{kafka.framework-name}}",
    "USER": "{{service.user}}",
    "PLACEMENT_STRATEGY": "{{service.placement-strategy}}",
    "PLAN_STRATEGY": "{{service.plan-strategy}}",
    "BROKER_COUNT": "{{brokers.count}}",
    "BROKER_CPUS": "{{brokers.cpus}}",
    "BROKER_MEM": "{{brokers.mem}}",
    "BROKER_DISK": "{{brokers.disk}}",
    "KAFKA_VER_NAME": "kafka_2.10-0.9.0.1",
    "KAFKA_URI": "{{resource.assets.uris.kafka_tgz}}",
    "CONTAINER_HOOK_URI": "{{resource.assets.uris.container-hook-tgz}}",
    "OVERRIDER_URI": "{{resource.assets.uris.kafka-config-overrider-jar}}",
    "JAVA_URI": "{{resource.assets.uris.jre-tar-gz}}",
    "KAFKA_ADVERTISE_HOST_IP" : "{{kafka.kafka_advertise_host_ip}}",
    "KAFKA_OVERRIDE_RESERVED_BROKER_MAX_ID": "{{kafka.kafka_override_reserved_broker_max_id}}",
    "KAFKA_OVERRIDE_OFFSETS_TOPIC_COMPRESSION_CODEC": "{{kafka.kafka_override_offsets_topic_compression_codec}}",
    "KAFKA_OVERRIDE_REPLICA_FETCH_MIN_BYTES": "{{kafka.kafka_override_replica_fetch_min_bytes}}",
    "KAFKA_OVERRIDE_CONTROLLED_SHUTDOWN_RETRY_BACKOFF_MS": "{{kafka.kafka_override_controlled_shutdown_retry_backoff_ms}}",
    "KAFKA_OVERRIDE_LOG_FLUSH_OFFSET_CHECKPOINT_INTERVAL_MS": "{{kafka.kafka_override_log_flush_offset_checkpoint_interval_ms}}",
    "KAFKA_OVERRIDE_OFFSETS_TOPIC_NUM_PARTITIONS": "{{kafka.kafka_override_offsets_topic_num_partitions}}",
    "KAFKA_OVERRIDE_MAX_CONNECTIONS_PER_IP_OVERRIDES": "{{kafka.kafka_override_max_connections_per_ip_overrides}}",
    "KAFKA_OVERRIDE_LEADER_IMBALANCE_CHECK_INTERVAL_SECONDS": "{{kafka.kafka_override_leader_imbalance_check_interval_seconds}}",
    "KAFKA_OVERRIDE_INTER_BROKER_PROTOCOL_VERSION": "{{kafka.kafka_override_inter_broker_protocol_version}}",
    "KAFKA_OVERRIDE_REPLICA_SOCKET_TIMEOUT_MS": "{{kafka.kafka_override_replica_socket_timeout_ms}}",
    "KAFKA_OVERRIDE_GROUP_MAX_SESSION_TIMEOUT_MS": "{{kafka.kafka_override_group_max_session_timeout_ms}}",
    "KAFKA_OVERRIDE_METRICS_NUM_SAMPLES": "{{kafka.kafka_override_metrics_num_samples}}",
    "KAFKA_OVERRIDE_LOG_CLEANER_DELETE_RETENTION_MS": "{{kafka.kafka_override_log_cleaner_delete_retention_ms}}",
    "KAFKA_OVERRIDE_LOG_PREALLOCATE": "{{kafka.kafka_override_log_preallocate}}",
    "KAFKA_OVERRIDE_REPLICA_SOCKET_RECEIVE_BUFFER_BYTES": "{{kafka.kafka_override_replica_socket_receive_buffer_bytes}}",
    "KAFKA_OVERRIDE_OFFSET_METADATA_MAX_BYTES": "{{kafka.kafka_override_offset_metadata_max_bytes}}",
    "KAFKA_OVERRIDE_MESSAGE_MAX_BYTES": "{{kafka.kafka_override_message_max_bytes}}",
    "KAFKA_OVERRIDE_LOG_ROLL_JITTER_HOURS": "{{kafka.kafka_override_log_roll_jitter_hours}}",
    "KAFKA_OVERRIDE_OFFSETS_RETENTION_CHECK_INTERVAL_MS": "{{kafka.kafka_override_offsets_retention_check_interval_ms}}",
    "KAFKA_OVERRIDE_FETCH_PURGATORY_PURGE_INTERVAL_REQUESTS": "{{kafka.kafka_override_fetch_purgatory_purge_interval_requests}}",
    "KAFKA_OVERRIDE_LOG_RETENTION_CHECK_INTERVAL_MS": "{{kafka.kafka_override_log_retention_check_interval_ms}}",
    "KAFKA_OVERRIDE_LOG_INDEX_INTERVAL_BYTES": "{{kafka.kafka_override_log_index_interval_bytes}}",
    "KAFKA_OVERRIDE_NUM_NETWORK_THREADS": "{{kafka.kafka_override_num_network_threads}}",
    "KAFKA_OVERRIDE_OFFSETS_COMMIT_TIMEOUT_MS": "{{kafka.kafka_override_offsets_commit_timeout_ms}}",
    "KAFKA_OVERRIDE_OFFSETS_TOPIC_REPLICATION_FACTOR": "{{kafka.kafka_override_offsets_topic_replication_factor}}",
    "KAFKA_OVERRIDE_REPLICA_FETCH_MAX_BYTES": "{{kafka.kafka_override_replica_fetch_max_bytes}}",
    "KAFKA_OVERRIDE_CONNECTIONS_MAX_IDLE_MS": "{{kafka.kafka_override_connections_max_idle_ms}}",
    "KAFKA_OVERRIDE_SOCKET_REQUEST_MAX_BYTES": "{{kafka.kafka_override_socket_request_max_bytes}}",
    "KAFKA_OVERRIDE_METRICS_SAMPLE_WINDOW_MS": "{{kafka.kafka_override_metrics_sample_window_ms}}",
    "KAFKA_OVERRIDE_NUM_PARTITIONS": "{{kafka.kafka_override_num_partitions}}",
    "KAFKA_OVERRIDE_REPLICA_LAG_TIME_MAX_MS": "{{kafka.kafka_override_replica_lag_time_max_ms}}",
    "KAFKA_OVERRIDE_LOG_CLEANER_IO_BUFFER_LOAD_FACTOR": "{{kafka.kafka_override_log_cleaner_io_buffer_load_factor}}",
    "KAFKA_OVERRIDE_OFFSETS_COMMIT_REQUIRED_ACKS": "{{kafka.kafka_override_offsets_commit_required_acks}}",
    "KAFKA_OVERRIDE_AUTO_CREATE_TOPICS_ENABLE": "{{kafka.kafka_override_auto_create_topics_enable}}",
    "KAFKA_OVERRIDE_UNCLEAN_LEADER_ELECTION_ENABLE": "{{kafka.kafka_override_unclean_leader_election_enable}}",
    "KAFKA_OVERRIDE_REPLICA_FETCH_BACKOFF_MS": "{{kafka.kafka_override_replica_fetch_backoff_ms}}",
    "KAFKA_OVERRIDE_LOG_ROLL_HOURS": "{{kafka.kafka_override_log_roll_hours}}",
    "KAFKA_OVERRIDE_ZOOKEEPER_SESSION_TIMEOUT_MS": "{{kafka.kafka_override_zookeeper_session_timeout_ms}}",
    "KAFKA_OVERRIDE_PRODUCER_PURGATORY_PURGE_INTERVAL_REQUESTS": "{{kafka.kafka_override_producer_purgatory_purge_interval_requests}}",
    "KAFKA_OVERRIDE_GROUP_MIN_SESSION_TIMEOUT_MS": "{{kafka.kafka_override_group_min_session_timeout_ms}}",
    "KAFKA_OVERRIDE_LOG_INDEX_SIZE_MAX_BYTES": "{{kafka.kafka_override_log_index_size_max_bytes}}",
    "KAFKA_OVERRIDE_NUM_REPLICA_FETCHERS": "{{kafka.kafka_override_num_replica_fetchers}}",
    "KAFKA_OVERRIDE_MIN_INSYNC_REPLICAS": "{{kafka.kafka_override_min_insync_replicas}}",
    "KAFKA_OVERRIDE_LOG_FLUSH_INTERVAL_MESSAGES": "{{kafka.kafka_override_log_flush_interval_messages}}",
    "KAFKA_OVERRIDE_SOCKET_SEND_BUFFER_BYTES": "{{kafka.kafka_override_socket_send_buffer_bytes}}",
    "KAFKA_OVERRIDE_AUTO_LEADER_REBALANCE_ENABLE": "{{kafka.kafka_override_auto_leader_rebalance_enable}}",
    "KAFKA_OVERRIDE_LOG_CLEANER_ENABLE": "{{kafka.kafka_override_log_cleaner_enable}}",
    "KAFKA_OVERRIDE_QUEUED_MAX_REQUESTS": "{{kafka.kafka_override_queued_max_requests}}",
    "KAFKA_OVERRIDE_CONTROLLED_SHUTDOWN_MAX_RETRIES": "{{kafka.kafka_override_controlled_shutdown_max_retries}}",
    "KAFKA_OVERRIDE_OFFSETS_LOAD_BUFFER_SIZE": "{{kafka.kafka_override_offsets_load_buffer_size}}",
    "KAFKA_OVERRIDE_LOG_RETENTION_BYTES": "{{kafka.kafka_override_log_retention_bytes}}",
    "KAFKA_OVERRIDE_NUM_IO_THREADS": "{{kafka.kafka_override_num_io_threads}}",
    "KAFKA_OVERRIDE_CONTROLLER_SOCKET_TIMEOUT_MS": "{{kafka.kafka_override_controller_socket_timeout_ms}}",
    "KAFKA_OVERRIDE_LOG_RETENTION_HOURS": "{{kafka.kafka_override_log_retention_hours}}",
    "KAFKA_OVERRIDE_LOG_FLUSH_SCHEDULER_INTERVAL_MS": "{{kafka.kafka_override_log_flush_scheduler_interval_ms}}",
    "KAFKA_OVERRIDE_OFFSETS_RETENTION_MINUTES": "{{kafka.kafka_override_offsets_retention_minutes}}",
    "KAFKA_OVERRIDE_QUOTA_WINDOW_SIZE_SECONDS": "{{kafka.kafka_override_quota_window_size_seconds}}",
    "KAFKA_OVERRIDE_LOG_SEGMENT_BYTES": "{{kafka.kafka_override_log_segment_bytes}}",
    "KAFKA_OVERRIDE_LEADER_IMBALANCE_PER_BROKER_PERCENTAGE": "{{kafka.kafka_override_leader_imbalance_per_broker_percentage}}",
    "KAFKA_OVERRIDE_MAX_CONNECTIONS_PER_IP": "{{kafka.kafka_override_max_connections_per_ip}}",
    "KAFKA_OVERRIDE_LOG_CLEANER_DEDUPE_BUFFER_SIZE": "{{kafka.kafka_override_log_cleaner_dedupe_buffer_size}}",
    "KAFKA_OVERRIDE_LOG_CLEANER_MIN_CLEANABLE_RATIO": "{{kafka.kafka_override_log_cleaner_min_cleanable_ratio}}",
    "KAFKA_OVERRIDE_ZOOKEEPER_SYNC_TIME_MS": "{{kafka.kafka_override_zookeeper_sync_time_ms}}",
    "KAFKA_OVERRIDE_QUOTA_CONSUMER_DEFAULT": "{{kafka.kafka_override_quota_consumer_default}}",
    "KAFKA_OVERRIDE_DELETE_TOPIC_ENABLE": "{{kafka.kafka_override_delete_topic_enable}}",
    "KAFKA_OVERRIDE_LOG_CLEANUP_POLICY": "{{kafka.kafka_override_log_cleanup_policy}}",
    "KAFKA_OVERRIDE_DEFAULT_REPLICATION_FACTOR": "{{kafka.kafka_override_default_replication_factor}}",
    "KAFKA_OVERRIDE_NUM_RECOVERY_THREADS_PER_DATA_DIR": "{{kafka.kafka_override_num_recovery_threads_per_data_dir}}",
    "KAFKA_OVERRIDE_LOG_CLEANER_IO_BUFFER_SIZE": "{{kafka.kafka_override_log_cleaner_io_buffer_size}}",
    "KAFKA_OVERRIDE_BACKGROUND_THREADS": "{{kafka.kafka_override_background_threads}}",
    "KAFKA_OVERRIDE_LOG_SEGMENT_DELETE_DELAY_MS": "{{kafka.kafka_override_log_segment_delete_delay_ms}}",
    "KAFKA_OVERRIDE_QUOTA_WINDOW_NUM": "{{kafka.kafka_override_quota_window_num}}",
    "KAFKA_OVERRIDE_REQUEST_TIMEOUT_MS": "{{kafka.kafka_override_request_timeout_ms}}",
    "KAFKA_OVERRIDE_LOG_CLEANER_THREADS": "{{kafka.kafka_override_log_cleaner_threads}}",
    "KAFKA_OVERRIDE_QUOTA_PRODUCER_DEFAULT": "{{kafka.kafka_override_quota_producer_default}}",
    "KAFKA_OVERRIDE_LOG_CLEANER_BACKOFF_MS": "{{kafka.kafka_override_log_cleaner_backoff_ms}}",
    "KAFKA_OVERRIDE_CONTROLLED_SHUTDOWN_ENABLE": "{{kafka.kafka_override_controlled_shutdown_enable}}",
    "KAFKA_OVERRIDE_SOCKET_RECEIVE_BUFFER_BYTES": "{{kafka.kafka_override_socket_receive_buffer_bytes}}",
    "KAFKA_OVERRIDE_REPLICA_FETCH_WAIT_MAX_MS": "{{kafka.kafka_override_replica_fetch_wait_max_ms}}",
    "KAFKA_OVERRIDE_REPLICA_HIGH_WATERMARK_CHECKPOINT_INTERVAL_MS": "{{kafka.kafka_override_replica_high_watermark_checkpoint_interval_ms}}",
    "KAFKA_OVERRIDE_OFFSETS_TOPIC_SEGMENT_BYTES": "{{kafka.kafka_override_offsets_topic_segment_bytes}}",
    "KAFKA_OVERRIDE_LOG_CLEANER_IO_MAX_BYTES_PER_SECOND": "{{kafka.kafka_override_log_cleaner_io_max_bytes_per_second}}",
    "KAFKA_OVERRIDE_COMPRESSION_TYPE": "{{kafka.kafka_override_compression_type}}"
  },
  "uris": [
    "{{resource.assets.uris.jre-tar-gz}}",
    "{{resource.assets.uris.kafka-scheduler-jar}}",
    "{{resource.assets.uris.kafka_tgz}}"
  ],
  "healthChecks": [
    {
      "protocol": "COMMAND",
      "command": { "value": "export PATH=$PATH:$MESOS_SANDBOX/jre/bin && ./kafka_2.10-0.9.0.1/bin/kafka-topics.sh --zookeeper master.mesos:2181/{{kafka.framework-name}} --describe --under-replicated-partitions | wc -l | { read count; echo Under replicated partition count = $count; exit $count; }" },
      "gracePeriodSeconds": 300,
      "intervalSeconds": 60,
      "timeoutSeconds": 60,
      "maxConsecutiveFailures": 3
    }
  ],
  "ports": [0]
}
